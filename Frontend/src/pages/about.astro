---
import Nav from "../components/nav.astro";
const API_BASE_VALUE = import.meta.env.PUBLIC_API_BASE || "http://localhost:3001";
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles/global.css" />
    <link rel="stylesheet" href="/styles/about.css" />
    <!-- Favicon: place files in Frontend/public/ -->
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <title>About | Deante Mirijello</title>
  </head>

  <body>
    <Nav />

    <main data-api-base={API_BASE_VALUE}>
      <header class="page-header">
        <h1 data-i18n="about.title">About Me</h1>
        <p data-i18n="about.intro">
          I’m Deante Mirijello, a Computer Science student in Montreal who enjoys building
          full-stack software that solves real, practical problems. I like working across the
          stack—from backend APIs and data modeling to clean, accessible frontend interfaces—and
          I’m always trying to improve both code quality and user experience. I value teamwork,
          clear communication, and writing maintainable software that can grow over time. In the
          future, I’m looking for opportunities where I can keep learning from experienced
          developers, contribute to real production projects, and evolve into a strong software
          engineer focused on building reliable applications that people actually use.
        </p>
      </header>

      <section class="about-grid">
        <!-- Left: Work Experience -->
        <article class="about-card">
          <h2 data-i18n="about.workTitle">Work Experience</h2>
          <div class="info-row">
            <div>
              <h3 id="workTitle">Loading…</h3>
              <p class="muted" id="workDate">Loading…</p>
            </div>
          </div>
          <ul class="clean-list" id="workBullets"></ul>
        </article>

        <article class="about-card">
          <h2 data-i18n="about.schoolTitle">School Experience</h2>
          <div class="info-row">
            <div>
              <h3 id="schoolProgram">Loading…</h3>
              <p class="muted" id="schoolDate">Loading…</p>
            </div>
          </div>
          <ul class="clean-list" id="schoolBullets"></ul>
        </article>
      </section>

      <!-- Bottom: Resume download -->
      <section style="text-align:center;">
        <a href="/assets/DeanteResumeEn.pdf" download class="lang-btn" data-i18n="about.resumeDownload">Download Resume</a>
      </section>
    </main>
    <script type="module">
      const API_BASE = (() => {
        const envBase = document.querySelector("main").dataset.apiBase;
        const host = location.hostname;
        if (host === "localhost" || host === "127.0.0.1") return "http://localhost:3001";
        return envBase;
      })();
      const WORK_API = `${API_BASE}/about/work`;
      const SCHOOL_API = `${API_BASE}/about/school`;

      // Work Experience rendering
      const workTitleEl = document.getElementById("workTitle");
      const workDateEl = document.getElementById("workDate");
      const workBulletsEl = document.getElementById("workBullets");
      const schoolProgramEl = document.getElementById("schoolProgram");
      const schoolDateEl = document.getElementById("schoolDate");
      const schoolBulletsEl = document.getElementById("schoolBullets");

      function renderWork() {
        const data = window.__workData;
        if (!data) return;
        const lang = window.__lang || "en";
        const content = data[lang] || data.en || {};
        // Title combines company — role
        const company = data.company || "";
        const role = content.role || "";
        workTitleEl.textContent = company && role ? `${company} — ${role}` : (company || role || "");
        workDateEl.textContent = content.date || "";
        workBulletsEl.innerHTML = "";
        (content.bullets || []).forEach((b) => {
          const li = document.createElement("li");
          li.textContent = b;
          workBulletsEl.appendChild(li);
        });
      }

      async function loadWork() {
        try {
          const res = await fetch(WORK_API);
          window.__workData = await res.json();
          renderWork();
        } catch (e) {
          console.error(e);
        }
      }

      function renderSchool() {
        const data = window.__schoolData;
        if (!data) return;
        const lang = window.__lang || "en";
        const content = data[lang] || data.en || {};
        schoolProgramEl.textContent = content.program || "";
        schoolDateEl.textContent = content.date || "";
        schoolBulletsEl.innerHTML = "";
        (content.bullets || []).forEach((b) => {
          const li = document.createElement("li");
          li.textContent = b;
          schoolBulletsEl.appendChild(li);
        });
      }

      async function loadSchool() {
        try {
          const res = await fetch(SCHOOL_API);
          window.__schoolData = await res.json();
          renderSchool();
        } catch (e) {
          console.error(e);
        }
      }

      // Initial loads
      loadWork();
      loadSchool();
      // Re-render work on language change
      document.addEventListener("i18n:change", renderWork);
      document.addEventListener("i18n:change", renderSchool);
    </script>
    <script type="module" src="/js/i18n.js"></script>
  </body>
</html>
