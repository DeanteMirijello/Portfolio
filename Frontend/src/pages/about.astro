---
import Nav from "../components/nav.astro";
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles/global.css" />
    <!-- Favicon: place files in Frontend/public/ -->
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <title>About | Deante Mirijello</title>
  </head>

  <body>
    <Nav />

    <main>
      <header class="page-header">
        <h1 data-i18n="about.title">About Me</h1>
        <p data-i18n="about.intro">
          I’m Deante Mirijello, a Computer Science student in Montreal. I’m interested in
          full-stack development and building practical software.
        </p>
      </header>

      <section class="about-grid">
        <article class="about-card">
          <h2 data-i18n="about.skills">Skills</h2>
          <div style="display:flex;justify-content:flex-end;">
            <button id="skillsEditToggle" class="lang-btn" type="button">Edit</button>
          </div>

          <div class="about-block">
            <h3>Languages</h3>
            <div class="tags" id="skills-languages"></div>
          </div>

          <div class="about-block">
            <h3>Frameworks & Tools</h3>
            <div class="tags" id="skills-frameworks"></div>
          </div>

          <div class="about-block">
            <h3>Databases</h3>
            <div class="tags" id="skills-databases"></div>
          </div>

          <div class="about-block">
            <h3>Design</h3>
            <div class="tags" id="skills-design"></div>
          </div>

          <!-- Admin editor -->
          <section class="contact-card" id="skillsEditor" hidden>
            <form id="skillsForm">
              <div class="contact-row">
                <label class="contact-label" for="skillsCategory">Category</label>
                <select id="skillsCategory" class="contact-value">
                  <option value="languages">Languages</option>
                  <option value="frameworks">Frameworks & Tools</option>
                  <option value="databases">Databases</option>
                  <option value="design">Design</option>
                </select>
              </div>

              <div class="contact-row">
                <label class="contact-label" for="skillsValue">Value</label>
                <input id="skillsValue" type="text" class="contact-value" />
              </div>

              <div class="contact-row" id="skillsOldRow" hidden>
                <label class="contact-label" for="skillsOldValue">Editing</label>
                <input id="skillsOldValue" type="text" class="contact-value" readonly />
              </div>

              <div style="display:flex;gap:.5rem;justify-content:flex-end;padding-top:.75rem;">
                <button type="button" id="skillsCancel" class="lang-btn">Cancel</button>
                <button type="button" id="skillsAdd" class="lang-btn">Add</button>
                <button type="button" id="skillsUpdate" class="lang-btn">Update</button>
                <button type="button" id="skillsDelete" class="lang-btn">Delete</button>
              </div>
              <p id="skillsMsg" class="muted" style="margin-top:.5rem;"></p>
              <p class="muted">Tip: Click a tag to edit or delete it.</p>
            </form>
          </section>
        </article>

        <article class="about-card">
          <h2 data-i18n="about.experience">Experience</h2>

          <div class="info-row">
            <div>
              <h3>Costco — Stocker</h3>
              <p class="muted">Jun 2023 – Present</p>
            </div>
          </div>

          <ul class="clean-list">
            <li>Worked with a team to manage inventory and daily tasks.</li>
            <li>Helped customers in both English and French.</li>
            <li>Trained new employees and supported new staff.</li>
          </ul>

          <div class="divider"></div>

          <h2 data-i18n="about.education">Education</h2>
          <ul class="clean-list">
            <li><strong>Champlain College</strong> — 2022 – 2026</li>
            <li><strong>LBP High School</strong> — 2021 – 2022</li>
            <li><strong>VMC High School</strong> — 2017 – 2021</li>
          </ul>
        </article>
      </section>
    </main>
    <script type="module">
      const API = "http://localhost:3001/skills";
      const ids = {
        languages: document.getElementById("skills-languages"),
        frameworks: document.getElementById("skills-frameworks"),
        databases: document.getElementById("skills-databases"),
        design: document.getElementById("skills-design"),
      };
      const editToggle = document.getElementById("skillsEditToggle");
      const editor = document.getElementById("skillsEditor");
      const form = document.getElementById("skillsForm");
      const categorySel = document.getElementById("skillsCategory");
      const valueInput = document.getElementById("skillsValue");
      const msg = document.getElementById("skillsMsg");
      const oldRow = document.getElementById("skillsOldRow");
      const oldValueInput = document.getElementById("skillsOldValue");

      function renderList(cat, list) {
        const container = ids[cat];
        container.innerHTML = "";
        for (const v of list) {
          const el = document.createElement("span");
          el.className = "tag";
          el.textContent = v;
          el.dataset.cat = cat;
          el.dataset.value = v;
          container.appendChild(el);
        }
      }

      async function loadSkills() {
        const res = await fetch(API);
        const skills = await res.json();
        renderList("languages", skills.languages || []);
        renderList("frameworks", skills.frameworks || []);
        renderList("databases", skills.databases || []);
        renderList("design", skills.design || []);
        editor.hidden = true;
      }

      editToggle.addEventListener("click", () => {
        editor.hidden = !editor.hidden;
        editToggle.textContent = editor.hidden ? "Edit" : "Close";
        msg.textContent = "";
        oldRow.hidden = true;
        oldValueInput.value = "";
        valueInput.value = "";
      });

      // Click tag to prefill editor
      document.addEventListener("click", (e) => {
        const el = e.target;
        if (el.classList?.contains("tag") && el.dataset.cat) {
          editor.hidden = false;
          editToggle.textContent = "Close";
          categorySel.value = el.dataset.cat;
          valueInput.value = el.dataset.value;
          oldValueInput.value = el.dataset.value;
          oldRow.hidden = false;
        }
      });

      document.getElementById("skillsCancel").addEventListener("click", () => {
        editor.hidden = true;
        editToggle.textContent = "Edit";
        msg.textContent = "";
        oldRow.hidden = true;
        oldValueInput.value = "";
        valueInput.value = "";
      });

      async function postJSON(url, method, body) {
        const res = await fetch(url, { method, headers: { "Content-Type": "application/json" }, body: JSON.stringify(body) });
        const data = await res.json().catch(() => ({}));
        if (!res.ok) throw new Error((data.errors?.[0]?.msg) || data.error || "Request failed");
        return data;
      }

      document.getElementById("skillsAdd").addEventListener("click", async () => {
        msg.textContent = "Saving...";
        try {
          await postJSON(`${API}/items`, "POST", { category: categorySel.value, value: valueInput.value.trim() });
          await loadSkills();
          msg.textContent = "Added.";
        } catch (e) { msg.textContent = e.message; }
      });

      document.getElementById("skillsUpdate").addEventListener("click", async () => {
        msg.textContent = "Saving...";
        try {
          await postJSON(`${API}/items`, "PUT", { category: categorySel.value, oldValue: oldValueInput.value.trim(), newValue: valueInput.value.trim() });
          await loadSkills();
          msg.textContent = "Updated.";
        } catch (e) { msg.textContent = e.message; }
      });

      document.getElementById("skillsDelete").addEventListener("click", async () => {
        msg.textContent = "Deleting...";
        try {
          await postJSON(`${API}/items`, "DELETE", { category: categorySel.value, value: oldValueInput.value.trim() || valueInput.value.trim() });
          await loadSkills();
          msg.textContent = "Deleted.";
        } catch (e) { msg.textContent = e.message; }
      });

      loadSkills();
    </script>
  </body>
</html>
