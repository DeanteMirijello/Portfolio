---
import Layout from "../layouts/Layout.astro";
import Nav from "../components/nav.astro";
const API_BASE_VALUE = import.meta.env.PUBLIC_API_BASE || "http://localhost:3001";
---

<Layout>
  <Nav />
  <main data-api-base={API_BASE_VALUE}>
    <header class="page-header">
      <h1>Testimonials</h1>
      <p class="muted">Feedback from teachers and supervisors.</p>
    </header>

    <section class="contact-card" id="listCard" hidden>
      <div id="items"></div>
    </section>
  </main>

  <script type="module">
    const API_BASE = (() => {
      const envBase = document.querySelector("main").dataset.apiBase;
      const host = location.hostname;
      if (host === "localhost" || host === "127.0.0.1") return "http://localhost:3001";
      return envBase;
    })();
    const API = `${API_BASE}/testimonials`;
    const listCard = document.getElementById("listCard");
    const itemsDiv = document.getElementById("items");

    function render(items) {
      itemsDiv.innerHTML = "";
      if (!items.length) {
        itemsDiv.innerHTML = '<p class="muted">No testimonials yet.</p>';
        return;
      }
      for (const t of items) {
        const wrapper = document.createElement("div");
        wrapper.className = "card";
        wrapper.style.marginBottom = "0.75rem";
        wrapper.innerHTML = `
          <p style="margin:0"><strong>${t.author}</strong> ${t.role ? `— ${t.role}` : ""}</p>
          <p style="margin:0.25rem 0">“${t.quote}”</p>
        `;
        itemsDiv.appendChild(wrapper);
      }
    }

    async function load() {
      const res = await fetch(API);
      const items = await res.json();
      render(items);
      listCard.hidden = false;
    }

    load();
  </script>
</Layout>
