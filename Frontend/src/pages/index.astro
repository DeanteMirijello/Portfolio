---
import Layout from "../layouts/Layout.astro";
import Nav from "../components/nav.astro";
const API_BASE_VALUE = import.meta.env.PUBLIC_API_BASE || "http://localhost:3001";
---

<Layout>
  <link slot="head" rel="stylesheet" href="/styles/home.css" />
  <Nav />

  <main data-api-base={API_BASE_VALUE}>
    <section class="home-hero">
      <div class="hero-text">
        <h1 id="homeTitle">Loading…</h1>
        <p id="homeSubtitle">Loading…</p>
        <p class="muted" id="homeCurrentWrap" style="margin-top:.25rem;">
          <strong data-i18n="home.currentLabel">Currently working on:</strong> <span id="homeCurrent">Loading…</span>
        </p>
        <div class="cta-row">
          <a href="/contact" class="cta-btn primary" data-i18n="home.cta">Get in touch</a>
        </div>
      </div>

      <div class="hero-photo">
        <img
          src="/assets/me.jpg"
          alt="Photo of Deante Mirijello"
          class="profile-photo"
          id="homeProfilePhoto"
        />
      </div>
    </section>
  </main>

  <script type="module">
    const API_BASE = (() => {
      const envBase = document.querySelector("main").dataset.apiBase;
      const host = location.hostname;
      if (host === "localhost" || host === "127.0.0.1") return "http://localhost:3001";
      return envBase;
    })();
    function renderHome() {
      try {
        const data = window.__homeData;
        if (!data) return;
        const lang = window.__lang || "en";
        const content = data[lang] || data.en || {};

        const img = document.getElementById("homeProfilePhoto");
        if (img && data.image) img.src = data.image;

        const titleEl = document.getElementById("homeTitle");
        if (titleEl && content.title) titleEl.textContent = content.title;

        const subEl = document.getElementById("homeSubtitle");
        if (subEl && content.subtitle) subEl.textContent = content.subtitle;

        const currEl = document.getElementById("homeCurrent");
        if (currEl && content.current) currEl.textContent = content.current;
      } catch (e) {
        console.error("Failed to render home content", e);
      }
    }

    async function loadHomeData() {
      try {
        const res = await fetch(`${API_BASE}/home`);
        const data = await res.json();
        window.__homeData = data;
        renderHome();
      } catch (e) {
        console.error("Failed to load home data", e);
      }
    }

    // Initial load
    loadHomeData();

    // Re-render on language change
    document.addEventListener("i18n:change", renderHome);
  </script>
</Layout>
