---
import Layout from "../layouts/Layout.astro";
import Nav from "../components/nav.astro";
const API_BASE_VALUE = import.meta.env.PUBLIC_API_BASE || "http://localhost:3001";
---

<Layout>
  <Nav />

  <main data-api-base={API_BASE_VALUE}>
    <header class="page-header" style="display:flex;justify-content:space-between;align-items:center;gap:.5rem;">
      <div>
        <h1 data-i18n="contact.title">Contact</h1>
        <p data-i18n="contact.subtitle">Best ways to reach me.</p>
      </div>
    </header>

    <!-- View-only -->
    <section class="contact-card" id="viewCard" hidden>
      <div class="contact-row">
        <span class="contact-label" data-i18n="contact.location">Location</span>
        <span class="contact-value" id="vLocation"></span>
      </div>

      <div class="contact-row">
        <span class="contact-label" data-i18n="contact.email">Email</span>
        <a class="contact-link" id="vEmailLink"></a>
      </div>

      <div class="contact-row">
        <span class="contact-label" data-i18n="contact.github">GitHub</span>
        <a class="contact-link" id="vGithubLink" target="_blank" rel="noreferrer"></a>
      </div>

      <div class="contact-row">
        <span class="contact-label" data-i18n="contact.linkedin">LinkedIn</span>
        <a class="contact-link" id="vLinkedinLink" target="_blank" rel="noreferrer"></a>
      </div>
    </section>

    <!-- Edit mode removed; Admin page handles updates -->
  </main>

  <script type="module">
    const API_BASE = document.querySelector("main").dataset.apiBase;
    const API = `${API_BASE}/contact`;
    const viewCard = document.getElementById("viewCard");

    const viewEls = {
      vLocation: document.getElementById("vLocation"),
      vEmailLink: document.getElementById("vEmailLink"),
      vGithubLink: document.getElementById("vGithubLink"),
      vLinkedinLink: document.getElementById("vLinkedinLink"),
    };

    function setView(data) {
      viewEls.vLocation.textContent = data.location || "";
      viewEls.vEmailLink.href = data.email ? `mailto:${data.email}` : "#";
      viewEls.vEmailLink.textContent = data.email || "";
      viewEls.vGithubLink.href = data.github || "#";
      viewEls.vGithubLink.textContent = data.github?.replace("https://", "") || "";
      viewEls.vLinkedinLink.href = data.linkedin || "#";
      viewEls.vLinkedinLink.textContent = data.linkedin?.replace("https://", "") || "";
    }

    async function load() {
      try {
        const res = await fetch(API);
        const data = await res.json();
        setView(data);
        viewCard.hidden = false;
      } catch (e) {
        console.error(e);
        // no inline error shown in view-only mode
      }
    }

    load();
  </script>
</Layout>
