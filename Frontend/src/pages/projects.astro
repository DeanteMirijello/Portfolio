---
import Nav from "../components/nav.astro";
const API_BASE_VALUE = import.meta.env.PUBLIC_API_BASE || "http://localhost:3001";
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles/global.css" />
    <!-- Favicon: place files in Frontend/public/ -->
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <title>Projects | Deante Mirijello</title>
  </head>

  <body>
    <Nav />

    <main data-api-base={API_BASE_VALUE}>
      <header class="page-header">
        <h1 data-i18n="projects.title">Projects</h1>
        <p data-i18n="projects.subtitle">Some projects Iâ€™ve worked on during school and team projects.</p>
      </header>

      <section id="projectsGrid" class="projects-grid"></section>
      <script type="module">
        const API_BASE = document.querySelector("main").dataset.apiBase;
        async function renderProjects() {
          try {
            const res = await fetch(`${API_BASE}/projects`);
            const data = await res.json();
            const grid = document.getElementById("projectsGrid");
            grid.innerHTML = "";
            const lang = window.__lang || "en";

            const linkMap = {
              dm: {
                github: "https://github.com/Ayoub-Seddik/dm-creation",
                live: "https://www.dmcreations.ca/",
              },
              pet: {
                github: "https://github.com/cgerard321/champlain_petclinic",
                live: "https://petclinic.benmusicgeek.synology.me/",
              },
              iot: {
                github: "https://github.com/DeanteMirijello/IOT-Living-Home-System",
              },
              bowling: {
                github: "https://github.com/DeanteMirijello/Bowling-Alley-System",
              },
            };

            Object.entries(data).forEach(([id, entry]) => {
              const card = document.createElement("article");
              card.className = "project-card";
              const txt = entry[lang] || entry.en || {};
              card.innerHTML = `
                <div class="project-image"><img alt="${txt.title || id} screenshot" src="${entry.image || ''}" /></div>
                <div class="project-top">
                  <h2>${txt.title || id}</h2>
                  <span class="project-date">${txt.date || ''}</span>
                </div>
                <p>${txt.desc || ''}</p>
              `;
              const links = linkMap[id];
              if (links && (links.github || links.live)) {
                const linkDiv = document.createElement("div");
                linkDiv.style.marginTop = ".5rem";
                if (links.github) {
                  const a = document.createElement("a");
                  a.className = "contact-link";
                  a.href = links.github;
                  a.target = "_blank";
                  a.rel = "noreferrer";
                  a.textContent = "GitHub Repository";
                  linkDiv.appendChild(a);
                }
                if (links.live) {
                  const a2 = document.createElement("a");
                  a2.className = "contact-link";
                  a2.href = links.live;
                  a2.target = "_blank";
                  a2.rel = "noreferrer";
                  a2.textContent = "Live Site";
                  a2.style.marginLeft = "1rem";
                  linkDiv.appendChild(a2);
                }
                card.appendChild(linkDiv);
              }
              grid.appendChild(card);
            });
          } catch (e) {
            console.error("Failed to load projects", e);
          }
        }

        renderProjects();
        // Update when language changes
        document.addEventListener("click", (e) => {
          if (e.target.closest("[data-lang-toggle]")) setTimeout(renderProjects, 100);
        });
      </script>
    </main>
  </body>
</html>
