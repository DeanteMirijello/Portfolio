---
const AUTH0_DOMAIN = import.meta.env.PUBLIC_AUTH0_DOMAIN || "";
const AUTH0_CLIENT_ID = import.meta.env.PUBLIC_AUTH0_CLIENT_ID || "";
const AUTH0_AUDIENCE = import.meta.env.PUBLIC_AUTH0_AUDIENCE || "";
const ADMIN_EMAILS = import.meta.env.PUBLIC_ADMIN_EMAILS || "";
const ROLES_CLAIM = import.meta.env.PUBLIC_AUTH0_ROLES_CLAIM || "https://your.app/roles";
---

<nav class="site-nav" data-auth-config data-auth-domain={AUTH0_DOMAIN} data-auth-client={AUTH0_CLIENT_ID} data-auth-aud={AUTH0_AUDIENCE} data-admin-emails={ADMIN_EMAILS} data-roles-claim={ROLES_CLAIM}>
  <div class="nav-links">
    <a href="/" data-i18n="nav.home">Home</a>
    <a href="/about" data-i18n="nav.about">About</a>
    <a href="/skills" data-i18n="nav.skills">Skills</a>
    <a href="/projects" data-i18n="nav.projects">Projects</a>
    <a href="/contact" data-i18n="nav.contact">Contact</a>
    <a href="/testimonials" data-i18n="nav.testimonials">Testimonials</a>
    <a id="adminLink" href="/admin" class="admin-link" style="display:none">Admin</a>
  </div>

  <div class="nav-right">
    <button
      class="lang-btn"
      type="button"
      data-lang-toggle
      aria-label="Change language"
    >
      FR
    </button>
    <button id="loginBtn" type="button" class="lang-btn">Log in</button>
    <button id="signupBtn" type="button" class="lang-btn">Create account</button>
    <button id="logoutBtn" type="button" class="lang-btn" style="display:none">Log out</button>
  </div>
</nav>

<script>
  // Highlight active nav link
  const currentPath = window.location.pathname.replace(/\/$/, "");

  document.querySelectorAll(".site-nav a").forEach((link) => {
    const linkPath = link.getAttribute("href").replace(/\/$/, "");

    // Handle home page separately
    if (linkPath === "" && currentPath === "") {
      link.classList.add("active");
    } else if (linkPath !== "" && currentPath === linkPath) {
      link.classList.add("active");
    }
  });
</script>
<script type="module" src="/js/auth.js"></script>
<script type="module" src="/js/i18n.js"></script>
<script type="module">
  // Auth UI wiring
  function updateAuthUI(detail) {
    const loginBtn = document.getElementById("loginBtn");
    const signupBtn = document.getElementById("signupBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const adminLink = document.getElementById("adminLink");
    const isAuthed = detail?.isAuthenticated;
    const isAdmin = detail?.isAdmin;
    if (loginBtn) loginBtn.style.display = isAuthed ? "none" : "inline-block";
    if (signupBtn) signupBtn.style.display = isAuthed ? "none" : "inline-block";
    if (logoutBtn) logoutBtn.style.display = isAuthed ? "inline-block" : "none";
    if (adminLink) adminLink.style.display = isAdmin ? "inline-block" : "none";
  }

  window.addEventListener("auth:change", (e) => updateAuthUI(e.detail));

  const loginBtn = document.getElementById("loginBtn");
  const signupBtn = document.getElementById("signupBtn");

  loginBtn?.addEventListener("click", () => {
    window.__auth?.login();
  });

  signupBtn?.addEventListener("click", async () => {
    await window.__auth?.signup();
  });

  document.getElementById("logoutBtn")?.addEventListener("click", () => {
    window.__auth?.logout();
  });

  // If auth initialized before this script loaded, force one UI sync soon
  setTimeout(() => {
    if (window.__auth) {
      updateAuthUI({
        isAuthenticated: window.__auth.isAuthenticated,
        isAdmin: window.__auth.isAdmin,
      });
    }
  }, 100);
</script>
